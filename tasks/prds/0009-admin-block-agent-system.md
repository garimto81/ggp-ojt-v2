# PRD: Admin Dashboard Block Agent System

**Version**: 1.0.0
**Date**: 2025-12-10
**Author**: Claude Code
**Status**: Draft
**Priority**: P1
**Issue**: #197

---

## 1. 개요

### 1.1 배경

현재 Admin Dashboard는 단일 `admin-agent`가 4개 탭(Users, Docs, Stats, Settings)의 모든 기능을 담당합니다. 이로 인해:

- **UI 패턴 불일치**: Users 탭(테이블+인라인)과 Docs 탭(Split View)의 상이한 UX
- **상태 관리 복잡성**: `AdminDashboard.jsx`에 모든 상태가 집중 (700+ LOC)
- **유지보수 어려움**: 기능 추가 시 단일 파일 수정 필요
- **테스트 어려움**: 모놀리식 구조로 인한 단위 테스트 곤란

### 1.2 목적

Admin Dashboard를 **4개의 독립적인 Block Agent**로 분리하여:

1. 각 탭별 전담 에이전트 할당
2. UI 패턴 통일 (Split View 기반)
3. 상태 관리 분산 및 단순화
4. 독립적인 개발/테스트 가능

### 1.3 범위

| 포함 | 제외 |
|------|------|
| Users/Docs/Stats/Settings 블럭 분리 | 신규 기능 추가 |
| UI 패턴 통일 | 모바일 반응형 |
| 상태 관리 개선 | 서버사이드 페이지네이션 |
| 에이전트 정의 문서화 | 성능 최적화 (가상화) |

---

## 2. 대상 사용자

### 2.1 Admin (관리자)

| 역할 | 주요 작업 | 현재 문제점 |
|------|----------|------------|
| 사용자 관리 | 역할/부서 변경, 활성화, 삭제 | 테이블 UI에서 상세 정보 부족 |
| 콘텐츠 관리 | 검토/승인/숨김/삭제 | Split View로 효율적 (유지) |
| 통계 분석 | 학습 현황, 취약점 파악 | 기간 선택 불가 (7일 고정) |
| 시스템 설정 | 부서 관리, 로그 조회 | UI 개선 필요 |

### 2.2 개발자 (Claude Code Agent)

| 역할 | 주요 작업 | 현재 문제점 |
|------|----------|------------|
| 기능 개발 | 탭별 기능 추가/수정 | 단일 파일 수정으로 충돌 위험 |
| 버그 수정 | 이슈별 대응 | 영향 범위 파악 어려움 |
| 테스트 작성 | 단위/통합 테스트 | 모놀리식 구조로 테스트 곤란 |

---

## 3. 핵심 기능

### 3.1 Block 구조 분리 (P0)

**문제**: 단일 `admin-agent`가 모든 기능 담당

**해결**:
```
features/admin/
├── AdminDashboard.jsx      # 탭 컨테이너만 (라우팅)
├── blocks/
│   ├── users/              # admin-users-agent
│   │   ├── components/
│   │   │   ├── UsersBlock.jsx
│   │   │   ├── UsersList.jsx
│   │   │   └── UserDetailPanel.jsx
│   │   ├── hooks/
│   │   │   └── useUsersManagement.js
│   │   └── index.js
│   │
│   ├── content/            # admin-content-agent
│   │   ├── components/
│   │   │   ├── ContentBlock.jsx
│   │   │   ├── ContentList.jsx
│   │   │   └── ContentPreview.jsx
│   │   ├── hooks/
│   │   │   └── useContentManagement.js
│   │   └── index.js
│   │
│   ├── stats/              # admin-stats-agent
│   │   ├── components/
│   │   │   ├── StatsBlock.jsx
│   │   │   └── charts/
│   │   ├── hooks/
│   │   │   └── useAnalytics.js
│   │   └── index.js
│   │
│   └── settings/           # admin-settings-agent
│       ├── components/
│       │   ├── SettingsBlock.jsx
│       │   ├── DepartmentSettings.jsx
│       │   └── AuditLogs.jsx
│       ├── hooks/
│       │   └── useSettings.js
│       └── index.js
│
├── shared/                 # 공유 컴포넌트
│   ├── AdminHeader.jsx
│   ├── AdminTabs.jsx
│   └── ConfirmModal.jsx
│
├── hooks/                  # 공유 훅
│   └── useAdminAuth.js
│
└── index.js
```

**우선순위**: Critical
**예상 공수**: 2일

---

### 3.2 Users Block - UI 패턴 통일 (P0)

**문제**: 테이블+인라인 편집으로 Docs 탭과 불일치

**현재 흐름**:
```
[테이블] → [인라인 Select 변경] → [즉시 저장]
                    ↓
            [Side Panel] (클릭 시)
```

**개선 흐름** (Split View 통일):
```
┌─────────────────────────────────────────────────────┐
│ Users Block (Split View)                            │
├──────────────────┬──────────────────────────────────┤
│ [UsersList]      │ [UserDetailPanel]                │
│  40%             │  60%                             │
│                  │                                  │
│ ┌──────────────┐ │ ┌────────────────────────────┐   │
│ │ 검색/필터    │ │ │ 사용자 상세 정보           │   │
│ ├──────────────┤ │ │ • 이름, 이메일             │   │
│ │ 사용자 목록  │ │ │ • 역할 선택                │   │
│ │ • 이름      │ │ │ • 부서 선택                │   │
│ │ • 역할 배지 │ │ │ • 가입일, 최근 활동        │   │
│ │ • 상태      │ │ │ • 학습 진도 요약           │   │
│ │             │ │ ├────────────────────────────┤   │
│ │ [클릭 선택] │ │ │ [저장] [활성화/정지] [삭제]│   │
│ └──────────────┘ │ └────────────────────────────┘   │
└──────────────────┴──────────────────────────────────┘
```

**장점**:
- Docs 탭과 동일한 UX 패턴
- 상세 정보 한눈에 확인
- 편집 전 미리보기 가능
- 실수로 인한 잘못된 변경 방지

**우선순위**: Critical
**예상 공수**: 1일

---

### 3.3 Content Block - 기존 유지 + 개선 (P1)

**현재 상태**: Split View 구현됨 (유지)

**개선 사항**:
- [ ] DocsContext 상태 동기화 문제 해결
- [ ] 상태 변경 후 목록 자동 갱신
- [ ] 신고 처리 UI 개선 (#124)

**우선순위**: High
**예상 공수**: 0.5일

---

### 3.4 Stats Block - 기간 선택 추가 (P2)

**문제**: 7일 고정, 기간 선택 불가

**개선**:
```jsx
<PeriodSelector
  options={['7일', '30일', '90일', '전체']}
  onChange={setPeriod}
/>
```

**우선순위**: Medium
**예상 공수**: 0.5일

---

### 3.5 Settings Block - 분리 (P2)

**현재 상태**: 기본 구현됨

**개선 사항**:
- [ ] 부서 관리 CRUD 완성
- [ ] Audit Logs 페이지네이션
- [ ] 시스템 설정 항목 추가

**우선순위**: Medium
**예상 공수**: 0.5일

---

### 3.6 공유 컴포넌트 - ConfirmModal (P1)

**문제**: `window.confirm()` 사용 (구식 UI)

**개선**:
```jsx
<ConfirmModal
  isOpen={showConfirm}
  title="사용자 삭제"
  message="정말 삭제하시겠습니까?"
  confirmText="삭제"
  confirmVariant="danger"
  requireInput={{
    label: "확인을 위해 사용자 이름을 입력하세요",
    expectedValue: user.name
  }}
  onConfirm={handleDelete}
  onCancel={() => setShowConfirm(false)}
/>
```

**우선순위**: High
**예상 공수**: 0.5일

---

## 4. 기술 요구사항

### 4.1 에이전트 정의

| Agent | 경로 | 책임 | Blocks |
|-------|------|------|--------|
| `admin-users-agent` | `features/admin/blocks/users/` | 사용자 CRUD, 역할/부서 관리 | `admin.users` |
| `admin-content-agent` | `features/admin/blocks/content/` | 콘텐츠 검토/승인/삭제 | `admin.content` |
| `admin-stats-agent` | `features/admin/blocks/stats/` | 통계 분석, 차트 | `admin.stats` |
| `admin-settings-agent` | `features/admin/blocks/settings/` | 시스템 설정, 로그 | `admin.settings` |

### 4.2 JSDoc 주석 규칙

```javascript
/**
 * UsersBlock - 사용자 관리 블럭 컴포넌트
 * @agent admin-users-agent
 * @blocks admin.users
 */
export default function UsersBlock() { ... }
```

### 4.3 상태 관리 분리

**Before** (AdminDashboard.jsx):
```javascript
// 700+ LOC, 모든 상태 집중
const [allUsers, setAllUsers] = useState([]);
const [userSearch, setUserSearch] = useState('');
const [userRoleFilter, setUserRoleFilter] = useState('');
// ... 20+ 상태 변수
```

**After** (각 Block 내부):
```javascript
// UsersBlock.jsx - 사용자 관련 상태만
const { users, isLoading, error } = useUsersManagement();
const [selectedUser, setSelectedUser] = useState(null);

// ContentBlock.jsx - 콘텐츠 관련 상태만
const { docs, isLoading } = useDocs();
const [selectedDoc, setSelectedDoc] = useState(null);
```

### 4.4 Lazy Loading

```javascript
// AdminDashboard.jsx
const UsersBlock = lazy(() => import('./blocks/users'));
const ContentBlock = lazy(() => import('./blocks/content'));
const StatsBlock = lazy(() => import('./blocks/stats'));
const SettingsBlock = lazy(() => import('./blocks/settings'));
```

### 4.5 의존성

| 패키지 | 용도 | 상태 |
|--------|------|------|
| `allotment` | Split View | 이미 설치됨 |
| `chart.js` | 통계 차트 | 이미 설치됨 |
| `react-chartjs-2` | React 래퍼 | 이미 설치됨 |

---

## 5. UI 목업

### 5.1 AdminDashboard (탭 컨테이너)

```
┌──────────────────────────────────────────────────────────────┐
│  OJT Master - Admin Dashboard                    [사용자명] │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐                │
│  │ 👥     │ │ 📄     │ │ 📊     │ │ ⚙️     │                │
│  │ 사용자 │ │ 콘텐츠 │ │ 통계   │ │ 설정   │                │
│  │   12   │ │   45   │ │        │ │        │                │
│  └────────┘ └────────┘ └────────┘ └────────┘                │
│   ═══════                                                    │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │                                                        │  │
│  │              [Selected Block Content]                  │  │
│  │                                                        │  │
│  │                                                        │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 5.2 Users Block (Split View)

```
┌──────────────────────────────────────────────────────────────┐
│ 👥 사용자 관리                                               │
├─────────────────────────┬────────────────────────────────────┤
│ [🔍 검색...]            │                                    │
│ 역할: [전체 ▼]          │  ┌────────────────────────────────┐│
│ 부서: [전체 ▼]          │  │ 👤 홍길동                      ││
├─────────────────────────┤  │                                ││
│                         │  │ 이메일: hong@company.com       ││
│ ┌─────────────────────┐ │  │ 역할:   [Mentor ▼]             ││
│ │ 🟢 홍길동           │ │  │ 부서:   [개발팀 ▼]             ││
│ │ Mentor · 개발팀     │ │  │                                ││
│ └─────────────────────┘ │  │ 가입일: 2025-01-15             ││
│ ┌─────────────────────┐ │  │ 최근활동: 2시간 전             ││
│ │ 🟢 김철수           │ │  │                                ││
│ │ Mentee · 기획팀     │ │  │ ── 학습 진도 ──                ││
│ └─────────────────────┘ │  │ 완료: 8/15 문서 (53%)          ││
│ ┌─────────────────────┐ │  │ 퀴즈 통과율: 85%               ││
│ │ 🔴 박영희 (정지됨)  │ │  │                                ││
│ │ Mentee · 마케팅팀   │ │  ├────────────────────────────────┤│
│ └─────────────────────┘ │  │ [저장] [활성화] [🗑️ 삭제]      ││
│                         │  └────────────────────────────────┘│
│ 1-10 / 45               │                                    │
│ [◀] [1] [2] [3] [▶]     │                                    │
└─────────────────────────┴────────────────────────────────────┘
```

### 5.3 Content Block (기존 유지)

```
┌──────────────────────────────────────────────────────────────┐
│ 📄 콘텐츠 관리                                               │
├─────────────────────────┬────────────────────────────────────┤
│ [전체] [검토대기] [신고]│                                    │
│ [🔍 검색...]            │  ┌────────────────────────────────┐│
├─────────────────────────┤  │ 📄 신입사원 안전교육            ││
│                         │  │ 작성자: 홍길동 · 개발팀         ││
│ ┌─────────────────────┐ │  │ 상태: 🟡 검토대기              ││
│ │ 🟡 신입사원 안전교육│ │  ├────────────────────────────────┤│
│ │ 홍길동 · 검토대기   │ │  │ [섹션] [퀴즈] [신고]           ││
│ └─────────────────────┘ │  │                                ││
│ ┌─────────────────────┐ │  │ ## 1. 안전 수칙               ││
│ │ 🟢 업무 프로세스    │ │  │ 작업장에서 반드시 지켜야 할   ││
│ │ 김철수 · 게시됨     │ │  │ 안전 수칙을 알아봅니다...     ││
│ └─────────────────────┘ │  │                                ││
│                         │  │ ## 2. 보호구 착용              ││
│                         │  │ 개인 보호구의 종류와...        ││
│                         │  ├────────────────────────────────┤│
│                         │  │ [✅ 게시] [🗑️ 삭제]            ││
│                         │  └────────────────────────────────┘│
└─────────────────────────┴────────────────────────────────────┘
```

### 5.4 Stats Block

```
┌──────────────────────────────────────────────────────────────┐
│ 📊 통계 분석                    기간: [최근 7일 ▼]          │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│  │ 총 멘티  │ │ 활동중   │ │ 완료     │ │ 평균진도 │        │
│  │    45    │ │    32    │ │    12    │ │   67%    │        │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘        │
│                                                              │
│  ┌─────────────────────────┐ ┌─────────────────────────┐    │
│  │ 📈 일별 학습 활동       │ │ 🥧 퀴즈 통과율          │    │
│  │                         │ │                         │    │
│  │     ▄▄▄                 │ │      ████               │    │
│  │   ▄▄███▄▄               │ │    ██░░░░██             │    │
│  │ ▄▄██████▄▄              │ │   █░░░░░░░░█            │    │
│  │ Mo Tu We Th Fr Sa Su    │ │   통과: 78%             │    │
│  └─────────────────────────┘ └─────────────────────────┘    │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ ⚠️ 취약 파트 (실패율 높은 문서)                       │   │
│  │ 1. 안전교육 3장 - 실패율 45%                         │   │
│  │ 2. 업무프로세스 2장 - 실패율 38%                     │   │
│  └──────────────────────────────────────────────────────┘   │
└──────────────────────────────────────────────────────────────┘
```

### 5.5 Settings Block

```
┌──────────────────────────────────────────────────────────────┐
│ ⚙️ 시스템 설정                                               │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ 📋 부서 관리                              [+ 부서 추가]│  │
│  ├────────────────────────────────────────────────────────┤  │
│  │ 개발팀      │ 🟢 활성 │ [수정] [삭제]                  │  │
│  │ 기획팀      │ 🟢 활성 │ [수정] [삭제]                  │  │
│  │ 마케팅팀    │ 🟢 활성 │ [수정] [삭제]                  │  │
│  │ 디자인팀    │ 🔴 비활성│ [수정] [삭제]                  │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
│  ┌────────────────────────────────────────────────────────┐  │
│  │ 📜 감사 로그                               [내보내기]  │  │
│  ├────────────────────────────────────────────────────────┤  │
│  │ 2025-12-10 14:30 │ 홍길동 │ 문서 게시 │ 안전교육      │  │
│  │ 2025-12-10 14:25 │ Admin  │ 역할 변경 │ 김철수→Mentor │  │
│  │ 2025-12-10 14:20 │ Admin  │ 사용자 승인│ 박영희       │  │
│  └────────────────────────────────────────────────────────┘  │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## 6. 사용자 흐름

### 6.1 사용자 역할 변경 흐름 (개선)

```
[Admin 로그인]
     │
     ▼
[Admin Dashboard 진입]
     │
     ▼
[Users 탭 클릭] ───────────────────────────────────────┐
     │                                                 │
     ▼                                                 │
[Split View 렌더링]                                    │
     │                                                 │
     ├─ [좌측] 사용자 목록                              │
     │    └─ 검색/필터 적용                            │
     │                                                 │
     └─ [우측] 상세 패널 (선택 대기)                    │
                                                       │
[사용자 클릭] ─────────────────────────────────────────┘
     │
     ▼
[상세 패널 표시]
     │
     ├─ 기본 정보 (이름, 이메일)
     ├─ 역할 선택 드롭다운
     ├─ 부서 선택 드롭다운
     └─ 학습 진도 요약
     │
     ▼
[역할 변경 선택] ────────────────────────────────────────┐
     │                                                  │
     ▼                                                  │
[저장 버튼 클릭]                                        │
     │                                                  │
     ▼                                                  │
[ConfirmModal 표시] ◄───────────────────────────────────┘
     │
     ├─ "홍길동의 역할을 Mentor로 변경하시겠습니까?"
     │
     ▼
[확인] ──────────────────────────────────────────────────┐
     │                                                  │
     ▼                                                  │
[API 호출] ─────────────────────────────────────────────┘
     │
     ▼
[성공] ──► [Toast 알림] ──► [목록 갱신] ──► [완료]
     │
[실패] ──► [Toast 에러] ──► [재시도 가능]
```

### 6.2 콘텐츠 승인 흐름 (기존 유지)

```
[Docs 탭] → [검토대기 필터] → [문서 선택] → [미리보기]
                                              │
                              ┌───────────────┴───────────────┐
                              │                               │
                              ▼                               ▼
                         [게시 클릭]                    [삭제 클릭]
                              │                               │
                              ▼                               ▼
                         [API 호출]                   [2단계 확인]
                              │                               │
                              ▼                               ▼
                         [목록 갱신]                    [API 호출]
```

---

## 7. 비기능 요구사항

### 7.1 성능

| 지표 | 목표 | 현재 |
|------|------|------|
| 초기 로드 | < 2s | ~3s |
| 탭 전환 | < 300ms | ~500ms |
| 검색 응답 | < 500ms | ~300ms (debounce) |

### 7.2 접근성

- WCAG 2.1 AA 준수 (기존 유지)
- 키보드 네비게이션 지원
- 스크린 리더 호환

### 7.3 보안

- Admin 역할 검증 (기존 유지)
- 2단계 삭제 확인 → ConfirmModal로 개선
- CSRF 보호 (이름 입력 확인)

---

## 8. 성공 지표

| 지표 | 목표 | 측정 방법 |
|------|------|----------|
| 코드 분리 | 4개 블럭 완성 | 파일 구조 확인 |
| UI 통일 | Split View 100% | 시각적 검증 |
| LOC 감소 | AdminDashboard < 100 LOC | 코드 분석 |
| 테스트 커버리지 | 각 블럭 > 60% | Vitest coverage |

---

## 9. 구현 계획

### Phase 1: 구조 분리 (1일)

- [ ] `blocks/` 디렉토리 생성
- [ ] 각 블럭별 기본 컴포넌트 이동
- [ ] `AdminDashboard.jsx` 리팩토링 (탭 컨테이너만)
- [ ] Barrel export 설정

### Phase 2: Users Block 개선 (1일)

- [ ] Split View 적용
- [ ] `UsersList.jsx` 구현
- [ ] `UserDetailPanel.jsx` 구현
- [ ] `useUsersManagement.js` 훅 분리

### Phase 3: 공유 컴포넌트 (0.5일)

- [ ] `ConfirmModal.jsx` 구현
- [ ] `AdminTabs.jsx` 분리
- [ ] `AdminHeader.jsx` 분리

### Phase 4: 마무리 (0.5일)

- [ ] Content Block DocsContext 동기화
- [ ] Stats Block 기간 선택 추가
- [ ] 에이전트 문서 업데이트
- [ ] 테스트 작성

---

## 10. 의존성

### 10.1 선행 작업

| 작업 | 상태 | 이슈 |
|------|------|------|
| Split View 라이브러리 | ✅ 설치됨 | - |
| RLS 정책 설정 | ✅ 완료 | #192 |
| audit_logs 마이그레이션 | ✅ 완료 | #191 |

### 10.2 연관 이슈

| 이슈 | 제목 | 관계 |
|------|------|------|
| #197 | Admin Dashboard UX 개선 | 메인 이슈 |
| #124 | 신고 시스템 구현 | Content Block에서 처리 |
| #110 | 콘텐츠 미표시 버그 | Content Block에서 해결 |

---

## 11. 리스크

| 리스크 | 영향 | 완화 방안 |
|--------|------|----------|
| 기존 기능 회귀 | High | 단계별 테스트, 기존 테스트 유지 |
| 상태 관리 복잡성 | Medium | 각 블럭 독립적 상태로 분리 |
| 마이그레이션 시간 | Medium | Phase별 점진적 적용 |

---

## 12. 참고 자료

- [Block Agent System v1.3.0](../../docs/BLOCK_AGENT_SYSTEM.md)
- [Admin Page Specification](../../docs/design/ADMIN_PAGE_SPECIFICATION.md)
- [UI Best Practices 2025](../../docs/design/UI_BEST_PRACTICES_2025.md)
- [Issue #197](https://github.com/garimto81/ggp-ojt-v2/issues/197)

---

## 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0.0 | 2025-12-10 | Claude Code | 초안 작성 |
