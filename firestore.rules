rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // 사용자 프로필: 본인만 읽기/쓰기
    match /artifacts/{appId}/users/{userId}/profile/me {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // OJT 문서: 작성자는 모든 권한, 인증된 사용자는 읽기만
    match /artifacts/{appId}/users/{userId}/ojt_docs/{docId} {
      // 작성자는 모든 권한
      allow read, write: if request.auth != null && request.auth.uid == userId;
      // 다른 인증된 사용자는 읽기만 가능 (멘티가 멘토 자료 열람)
      allow read: if request.auth != null;
    }

    // 공개 문서 컬렉션 (향후 확장용)
    match /artifacts/{appId}/public/ojt_docs/{docId} {
      // 모든 인증된 사용자 읽기 가능
      allow read: if request.auth != null;
      // 멘토만 쓰기 가능 (서버 측 역할 검증)
      allow write: if request.auth != null &&
        get(/databases/$(database)/documents/artifacts/$(appId)/users/$(request.auth.uid)/profile/me).data.role == 'mentor';
    }
  }
}
