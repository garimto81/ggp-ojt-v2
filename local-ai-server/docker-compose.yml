# OJT Master - 사내 Docker 배포
# Vercel 대체용 로컬 배포 (외부 AI 서버 연동)

services:
  # ============================================
  # OJT Master Web App
  # ============================================
  app:
    build:
      context: ..
      dockerfile: local-ai-server/Dockerfile.dev
      args:
        - VITE_SUPABASE_URL=${VITE_SUPABASE_URL}
        - VITE_SUPABASE_PUBLISHABLE_KEY=${VITE_SUPABASE_PUBLISHABLE_KEY:-${VITE_SUPABASE_ANON_KEY}}
        - VITE_LOCAL_AI_URL=${VITE_LOCAL_AI_URL}
        - VITE_R2_WORKER_URL=${VITE_R2_WORKER_URL:-}
    container_name: ojt-master
    ports:
      - "${APP_PORT:-80}:3000"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000/"]
      interval: 30s
      timeout: 5s
      retries: 3
